{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CroW</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>
<body>

    <div id="dashboard-view">
        <div class="dash-content-wrapper">
            <div class="dash-header">
                <div class="brand">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
                    CroW
                </div>
                
                <div class="search-box">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="searchInput" placeholder="Search wrappers..." onkeyup="filterWrappers()">
                </div>

                <button class="btn btn-primary" onclick="openCreateModal()">+ Create Wrapper</button>
            </div>
            <div id="wrapperGrid" class="wrapper-grid"><div class="empty-msg">Loading wrappers...</div></div>
        </div>

        <div class="app-footer">
            <div class="footer-content">
                <span>Copyright © 2024-2025 <b>SmartDB Lab</b>. All rights reserved.</span>
                <span class="footer-divider">|</span>
                <span>Designed By <a href="https://kallolnaha.me/" target="_blank" class="footer-link">Kallol Naha</a></span>
            </div>
        </div>
    </div>

    <div id="builder-view" class="hidden">
        <div class="builder-toolbar">
            <div class="session-info">
                <button class="btn btn-secondary" onclick="closeBuilder()">← Back</button>
                <span id="activeWrapperName">Untitled</span>
                <span class="session-tag" id="activeStatus">Active</span>
            </div>
        </div>
        <div id="proxy-warning" class="proxy-warning">
            <div class="warning-icon">⚠️</div>
            <div class="warning-text"><strong>Site looking broken?</strong> Don't worry. If you can see the text, the scraper works.</div>
            <button onclick="this.parentElement.remove()" class="warning-close">✕</button>
        </div>
        <div id="iframe-container">
            <div id="builderPlaceholder" style="color:#666">Loading target site...</div>
            <iframe id="site-viewer" src="about:blank"></iframe>
        </div>
    </div>

    <div id="createModal" class="modal-overlay hidden">
        <div class="modal">
            <h2 style="margin:0 0 20px 0;">New Wrapper</h2>
            <div class="form-group"><label>Wrapper Name</label><input type="text" id="inputName" class="form-control" placeholder="e.g. Amazon Products"></div>
            <div class="form-group"><label>Target URL</label><input type="text" id="inputUrl" class="form-control" placeholder="https://..." value=""></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="document.getElementById('createModal').classList.add('hidden')">Cancel</button>
                <button class="btn btn-primary" onclick="startSession()">Start Building</button>
            </div>
        </div>
    </div>

    <div id="runModal" class="modal-overlay hidden">
        <div class="modal">
            <h2 style="margin:0 0 10px 0;">Run Configuration</h2>
            <input type="hidden" id="runFilename"><input type="hidden" id="runBaseUrl">
            
            <div class="info-box">
                <svg class="info-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></svg>
                <div><strong>Configure Inputs</strong><br><span style="opacity:0.8; font-size:12px;">Edit fields below. <b>Tip:</b> Use commas for batching.</span></div>
            </div>

            <div id="paramsContainer" class="params-container"></div>

            <div style="border-top:1px solid #e5e7eb; padding-top:15px; margin-top:10px;">
                <h4 style="margin:0 0 10px 0; font-size:12px; color:#6b7280; text-transform:uppercase;">Output Settings</h4>
                
                <div class="form-group" style="display:flex; justify-content:space-between; align-items:center;">
                    <label style="margin:0;">Max Rows Limit (0 = Unlimited)</label>
                    <input type="number" id="runMaxItems" class="form-control" value="100" style="width:100px; text-align:right;">
                </div>

                <div class="form-group">
                    <label>Columns (Uncheck to hide, Type to rename)</label>
                    <div id="columnManager" style="max-height:150px; overflow-y:auto; border:1px solid #d1d5db; border-radius:6px; padding:10px; background:#f9fafb;">
                        </div>
                </div>
            </div>

            <div class="form-group"><label>Preview</label><div id="finalUrlPreview" class="url-preview">...</div></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="document.getElementById('runModal').classList.add('hidden')">Cancel</button>
                <button class="btn btn-primary" onclick="executeRun()">Run Extraction</button>
            </div>
        </div>
    </div>

    <div id="resultsModal" class="modal-overlay hidden">
        <div class="modal modal-lg">
            <div style="padding:20px; border-bottom:1px solid #e5e7eb; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">Results</h3>
                <button onclick="document.getElementById('resultsModal').classList.add('hidden')" style="background:none; border:none; color:#666; font-size:20px; cursor:pointer;">✕</button>
            </div>
            <div class="results-body" id="resultsBody"></div>
        </div>
    </div>

    <script>
        window.crowConfig = {
            apiBase: "{{ API_BASE_URL|default:'' }}",
            csrfToken: "{{ csrf_token }}"
        };
    </script>

    <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>